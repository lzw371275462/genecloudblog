# 3.3 吉云平台小工具开发
进入工具管理后，有 新建工具、类别设置、复制工具、导入工具、导出工具、权限设置6个主要功能。
## 1.类别设置
设置所开发工具的类别，例如：基础绘图
## 2. 新建工具
工具名称：必填，且提交后不可修改。
类别：选择，如果没有相关的类别使用，可以自己去设置。
工具简介：最多100字，介绍该工具具体可实现的功能，使用了什么方法等。
工具图标：上传2Mb以内的png/jpeg/bmp格式文件。
暂存：暂时保存已填写信息。
### 2.1 配置信息
#### 2.1.1. docker和资源
```
镜像：必填，不需要带ip
CPU：必填。
内存：必填。
挂载数据库：必填一个，可以多个，没有的时候可暂时填写数据库路径，不要填./ 或 /tmp等容易冲突的路径，后面会把这个默认要填写一个改为默认不填写
```
#### 2.1.2. 参数设置--新增
这里的参数支持类型为数字、文本、单选，与输入有所区别，输入中支持的类型为文件夹目录、单文件、多文件。填写好的参数保存后支持编辑和删除。

```
参数名：必填，支持字母、数字、下划线，至少一个字符，不能以数字开头。
页面显示名称：必填。
参数类型：必填，数字、文本、单选。
运行时是否必填：必填。
参数运行时默认值：非必填，当参数类型是“数字”或“文本”时，根据所选类型填入相应的内容。当参数类型是“单选”时，填写相应的label-value
页面描述：非必填。
```

#### 2.1.3. 输入--新增

输入中支持的类型为文件夹目录、单文件、多文件。填写好的参数保存后支持编辑和删除。
```
参数名：必填，支持字母、数字、下划线，至少一个字符，不能以数字开头。
页面显示名称：必填。
参数类型：必填，文件夹目录、单文件、多文件。类型为单、多文件时可上传示例文件。
运行时是否必填：必填。
参数说明：非必填。
```
#### 2.1.4. 输出--新增

**注意输出不是填写脚本中的输出参数，而是填写所有的结果文件名**。填写好的参数保存后支持编辑和删除。

如果流程内部只生成了pdf，没有png格式的文件，则在模板书写脚本处添加一行

```pdftoppm -png -rx 300 -ry 300 ${outpdf}".pdf" ${outpdf}```

软件参考镜像：`wrnaseq/tools:v2`

```
文件名：必填。如气泡图.svg。目前支持png、jpg格式，该类型可以直接展示在结果页面上。
相对路径：必填，当前路径写/，不要写./。
描述：必填，书写是什么结果文件。
```

#### 2.1.5. 模板
代码模板：是根据”docker与资源”、“参数设置”、“输入”、“输出”配置，按照shell的语法规则，自动生成最初始的代码。可以直接参考自动生成的参数名写运行命令。例如，以下示例pl脚本一个参数`-input`，一个`-o`。
如果 `-o `设置的外部参数是输出文件的前缀，则在写命令时可以写成`-o ${out}".pdf"`
也可以后台固定输出文件名，不写在参数中。

```
#auto comment start
#以下是参数名变量说明：
#
# ${i} : 输入矩阵文件  【required:true】
# ${out} : 输出pdf文件 【required:true】

#
#auto comment end
perl /GeneCloud001/genecloud/DB/git/genecloud_pipeline/genecloud_wrnaseq/tools_script/col2row.pl -input ${i} -o ${out}
##如果结果中没有png,则可以通过pdftoppm转换，rx、ry是像素,${out}是要转换的pdf文件，out是生成png文件的前缀。
pdftoppm -png -rx 300 -ry 300 ${out} out
```

同时也支持手动上传代码，直接展示到下方代码框。

#### 2.1.6. 使用说明
使用Markdown 编辑器插件，直接编写使用说明。提交前必填。
#### 2.1.7. 暂存
点击“暂存”后，可以将工具暂存。“工具名称”、“工具图标”、“工具类别”、“工具简介”填写且“工具名称”唯一，即可暂存。
#### 2.1.8. 提交发布
完成后提交发布
#### 2.1.9. 预览编辑下架
工具发布后支持预览、编辑和下架操作
```
“已发布”状态的工具，可以执行“预览、编辑、下架”操作。
“暂存”状态的工具，可以执行“预览、编辑、删除”操作。
“已下架”状态的工具，置灰，可以执行“预览、编辑、删除”操作，不能直接发布，必须重新编辑后，才可提交发布。
```
## 3. 复制工具
选中工具后，复制已有工具的所有信息，编辑后，生成新的工具，提交前需保证**工具名称不能与已有的相同**
## 4. 导出工具
选中工具后，点导出工具，可将工具的zip包下载至本地。
## 5. 导入工具
导入工具的zip包，改zip包来源于导出的工具，导入后可保留工具的所有信息。
## 6. 权限设置
对小工具进行授权设置，选中要授权的工具-授权设置--选中要授权的组织-授权设置-隐藏/运行/浏览。

目前已经上线的工具只对内部展示，即对外部组织设置隐藏。

## 说明
- 现在的挂载数据库深圳的写/GeneCloud001/路径，之后会改成/mnt路径，但不知道什么时候改。
- 小工具的运行输出不支持在terminal上查看，输出中的文件会展示在任务运行的结果栏中，需要将重要结果全部在输出中展示出来。
- 运行的结果在/GeneCloud001/genecloud/Org_Data/org_143/Tool_Data/<taskid>查看



